{% extends 'base_s.html' %}
{% load crispy_forms_tags %}

{% block title %}
{{title}}
{% endblock %}

{% block logo-link %}
{% url 'my_redirect' %}
{% endblock %}

{% block body %}
                <hr>
                <div class="container-lg bg-light rounded g-lg-10 me-auto px-3 py-1">
                  <p class="text-primary fw-bold my-2">Анализ регистрации:</p>
                  <p> Зарегистрированно кредитов: <span class="fw-bold">{{cf}}</span></p>
                  <p> Всего кредитов <small class="text-secondary">(с учетом запросов)</small>: <span class="fw-bold"> {{cr}} </span></p>
                  <p> Доступно к регистрации <small class="text-secondary">(с учетом запросов)</small>: <span class="fw-bold">{{co}}</span></p>
                  <hr class="mt-4 mb-4">
                  <p class="text-primary fw-bold my-2">Создать запрос:</p>
                <form action="{% url 'dis' %}" method="post" class="containet-sm px-5" novalidate>
                  <span class="mt-3 mb-3">
                        {% if submitted %}
                        <small class="text-success py-2">
                          Предмет успешно добавлен.
                        </small>
                        {% endif %}
                        {% csrf_token %}                                
                        {{ form | crispy }}
                      <span class="ml-5">
                        <button class="btn w-50 btn-sm btn-outline-success" type="submit">Создать запрос</button>
                      </span>
                  </span>
                </form>
                <hr class="mt-4 mb-4">
                  <p class="text-primary fw-bold my-2">Статистика регистрации:</p>
                  <form action="" method="POST">
                    <small class="text-center">
                      <table class="table table-striped table-bordered"> <!-- Все стденты -->
                        <thead>
                          <tr>
                            <th scope="col">Дисциплина</th>
                            <th scope="col">Форма контроля</th>
                            <th scope="col">Кол-во кредитов</th>
                            <th scope="col">Кол-во часов</th>
                            <th scope="col">Статус</th>
                            <th scope="col">Дата создания запроса</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for s in student %}
                            {% if s.user_id == user.id %}
                              {% for dr in dis_reg %}
                                {% if s.id == dr.student_id %}
                                  <tr>
                                    <th scope="row">{{ dr.discipline }}</th>
                                    <td>{{ dr.discipline.form_control }}</td>
                                    <td>{{ dr.discipline.credits }}</td>
                                    <td>{{ dr.discipline.hours }}</td>
                                    <td>
                                        {% if dr.conf == True %}
                                            <div class="form-check">
                                              <input class="form-check-input" type="checkbox" value="{{dr.id}}" name="cnf"><span class="text-success fw-bold">Подтверждено</span>
                                            </div>
                                        {% elif dr.abon == True %}
                                          <span class="text-danger fw-bold"><i class="fa-solid fa-xmark"></i> Отказано</span>
                                        {% else %}
                                          <span class="text-primary fw-bold"><i class="fa-solid fa-arrows-rotate"></i> В обработке</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ dr.date_of_reg}}</td>
                                  </tr>
                                {% endif %}
                              {% endfor %}
                            {% endif %}
                          {% endfor %}
                        </tbody>
                      </table>
                      <button class="btn w-50 btn-sm btn-outline-success m-4" type="submit" name="academ">Отправить на рассмотрение</button>
                    </small>

                  </form>
                </div>
{% endblock %}