{% extends 'base_s.html' %}
{% load crispy_forms_tags %}

{% block title %}
{{title}}
{% endblock %}

{% block logo-link %}
{% url 'my_redirect' %}
{% endblock %}

{% block body %}
                <hr>
                <div class="container-lg bg-light rounded g-lg-10 me-auto px-3 py-1">
                  <p class="text-primary fw-bold my-2">Анализ регистрации:</p>
                  <br>
                  <p> Успешно зарегистрированно : <span class="fw-bold">{{cf}}</span> кредита(-ов)</p>
                  <p> Запрошено на регистрацию всего: <span class="fw-bold"> {{cr}} </span>кредита(-ов)</p>
                  <p> Остаток кредитов доступный к регистрации <small class="text-secondary">(с учетом запросов)</small>: <span class="fw-bold">{{co}}</span> кредита(-ов)</p>
                  <p><span class="fw-bold"> 
                      {% for s in student %}
                        {% if s.user_id == user.id %}  
                          {% if s.groups.cours == 1 %}
                            В конце вашего курса, рекомендуемый остаток: 96 кредитов
                          {% elif s.groups.cours == 2 %}
                            В конце вашего курса рекомендуемый остаток: 64 крудита
                          {% elif s.groups.cours == 3 %}
                            В конце вашего курса рекомендуемый остаток: 32 кредита
                          {% elif s.groups.cours == 4 %}  
                            В конце вашего курса рекомендуемый остаток: 0 кредитов
                          {% endif %}
                        {% endif %}
                      {% endfor %}
                      </span>
                    </p>
                    <p><span class="fw-bold">Текущий семестр:
                      {% if m1 == True %}
                        Осень
                      {% endif %}
                      {% if m2 == True %}
                        Осень
                      {% endif %}
                      {% if m3 == True %}
                        Весна
                      {% endif %}
                      {% if m4 == True %}
                        Весна
                      {% endif %}
                      {% if is_i == True %}
                        Зимн/Летний
                      {% endif %}
                    </span>
                  </p>
                  <br>
                  <p class="fw-bold">Рабочая программа:</p>
                  <table class="table table-striped table-bordered border-$gray-500"> <!-- Все стденты -->
                    <thead>
                      <tr>
                        <th scope="col">Дисциплина</th>
                        <th scope="col">Форма контроля</th>
                        <th scope="col">Кол-во кредитов</th>
                        <th scope="col">Кол-во часов</th>
                        <th scope="col">Курс</th>
                        <th scope="col">Семестр</th>
                        <th scope="col">Статус</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for s in student %}
                        {% if s.user_id == user.id %}
                          {% for d in dis %}
                            {% if s.groups.department_id == d.department_id %}
                              {% if s.groups.cours >= d.course and d.credits < co%}
                                <tr>
                                  <th>
                                    {{d.name}}
                                  </th>
                                  <td>
                                    {{d.form_control}}
                                  </td>
                                  <td>
                                    {{d.credits}}
                                  </td>
                                  <td>
                                    {{d.hours}}
                                  </td>
                                  <td>
                                    {{d.course}}
                                  </td>
                                  <td>
                                    {% if d.fh == true %}
                                    Осень,  
                                    {% endif %}
                                    {% if d.sh == true %}
                                      Весна,  
                                    {% endif %}
                                    {% if d.xtr == true %}
                                      I,  
                                    {% endif %}
                                  </td>
                                  <td class="text-center">
                                    <span class="text-success fw-bold">Регистрация возможна</span>
                                  </td>
                                </tr>
                              {% else %}
                              <tr>
                                <th>
                                  {{d.name}}
                                </th>
                                <td>
                                  {{d.form_control}}
                                </td>
                                <td>
                                  {{d.credits}}
                                </td>
                                <td>
                                  {{d.hours}}
                                </td>
                                <td>
                                  {{d.course}}
                                </td>
                                <td>
                                  {% if d.fh == true %}
                                  Осень,  
                                  {% endif %}
                                  {% if d.sh == true %}
                                    Весна,  
                                  {% endif %}
                                  {% if d.xtr == true %}
                                    I,  
                                  {% endif %}
                                </td>
                                <td class="text-center">
                                  <span class="text-danger fw-bold">Регистрация невозможна</span>
                                  <hr class="mt-1 mb-1">
                                  <span class="text-secondary small">
                                  Причина: 
                                  {% if s.groups.cours < d.course%}
                                    Этот предмет для {{d.course}} курса.
                                  {% elif d.credits > co  %}
                                    Недостаточно кредитов.
                                  {% endif %}
                                  </span>
                                </td>
                              </tr>
                              {% endif %}
                            {% endif %}
                          {% endfor %}
                        {% endif %}
                      {% endfor %}
                    </tbody>
                  </table>
                  
                  <hr class="mt-4 mb-4">
                  <p class="text-primary fw-bold my-2">Создание запросов:
                  </p>
                <form action="{% url 'dis' %}" method="post" class="containet-sm px-5" novalidate>
                  <span class="mt-3 mb-3">
                        {% if submitted %}
                        <small class="text-success py-2">
                          Предмет успешно добавлен.
                        </small>
                        {% endif %}
                        {% csrf_token %}                                
                        {{ form | crispy }}
                      <span class="ml-5">
                        <button class="btn w-50 btn-sm btn-outline-success" type="submit" name="create">Создать запрос</button>
                      </span>
                  </span>
                </form>
                <hr class="mt-4 mb-4">
                  <p class="text-primary fw-bold my-2">Статистика регистрации:</p>
                    <small class="text-center">
                      <table class="table table-striped table-bordered border-$gray-500"> <!-- Все стденты -->
                        <thead>
                          <tr>
                            <th scope="col">Дисциплина</th>
                            <th scope="col">Форма контроля</th>
                            <th scope="col">Кол-во кредитов</th>
                            <th scope="col">Кол-во часов</th>
                            <th scope="col">Статус</th>
                            <th scope="col">Дата создания запроса</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for s in student %}
                            {% if s.user_id == user.id %}
                              {% for dr in dis_reg %}
                                {% if s.id == dr.student_id %}
                                  {% if d.hide != True %}
                                  <tr>
                                    <th scope="row">{{ dr.discipline }}</th>
                                    <td>{{ dr.discipline.form_control }}</td>
                                    <td>{{ dr.discipline.credits }}</td>
                                    <td>{{ dr.discipline.hours }}</td>
                                    <td>
                                      {% if dr.conf == True and dr.send != True%}
                                      <span class="text-success fw-bold"><i class="fa-solid fa-check"></i> Подтверждено</span>
                                      <br>
                                      <span class="text-secondary small">Ожидает отправку</span>
                                      {% elif dr.conf == True and dr.send == True%}
                                      <span class="text-success fw-bold"><i class="fa-solid fa-check"></i> Подтверждено</span>
                                      <br>
                                      <span class="text-secondary small">Отправлено</span>
                                        {% elif dr.abon == True %}
                                          <span class="text-danger fw-bold"><i class="fa-solid fa-xmark"></i> Отказано</span>
                                        {% else %}
                                          <span class="text-primary fw-bold"><i class="fa-solid fa-arrows-rotate"></i> В обработке</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ dr.date_of_reg}}</td>
                                  </tr>
                                  {% endif %}
                                {% endif %}
                              {% endfor %}
                            {% endif %}
                          {% endfor %}
                        </tbody>
                      </table>
                    </small>
                  <a href="{% url 'ac_conf' %}" class="btn btn-sm btn-outline-primary m-4 fw-bold">Страница отправки академ-советнику <i class="fa-solid fa-arrow-right"></i></a>
                </div>

{% endblock %}